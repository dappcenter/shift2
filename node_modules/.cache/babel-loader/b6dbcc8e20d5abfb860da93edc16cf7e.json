{"ast":null,"code":"var _jsxFileName = \"/Users/rp/Desktop/death/answers/src/views/Pools/components/PoolCard.tsx\",\n    _s = $RefreshSig$();\n\nimport BigNumber from 'bignumber.js';\nimport React, { useCallback, useState } from 'react';\nimport styled from 'styled-components';\nimport { Button, IconButton, useModal, AddIcon, Image } from '@pancakeswap-libs/uikit';\nimport { useWeb3React } from '@web3-react/core';\nimport UnlockButton from 'components/UnlockButton';\nimport Label from 'components/Label';\nimport { useERC20 } from 'hooks/useContract';\nimport { useSousApprove } from 'hooks/useApprove';\nimport useI18n from 'hooks/useI18n';\nimport { useSousStake } from 'hooks/useStake';\nimport { useSousUnstake } from 'hooks/useUnstake';\nimport { getBalanceNumber } from 'utils/formatBalance';\nimport { getPoolApy } from 'utils/apy';\nimport { useSousHarvest } from 'hooks/useHarvest';\nimport Balance from 'components/Balance';\nimport { QuoteToken, PoolCategory } from 'config/constants/types';\nimport { useGetApiPrice } from 'state/hooks';\nimport DepositModal from './DepositModal';\nimport WithdrawModal from './WithdrawModal';\nimport CompoundModal from './CompoundModal';\nimport CardTitle from './CardTitle';\nimport Card from './Card';\nimport OldSyrupTitle from './OldSyrupTitle';\nimport HarvestButton from './HarvestButton';\nimport CardFooter from './CardFooter';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst PoolCard = ({\n  pool\n}) => {\n  _s();\n\n  const {\n    sousId,\n    tokenName,\n    tokenAddress,\n    stakingTokenName,\n    stakingTokenAddress,\n    stakingTokenDecimals,\n    projectLink,\n    harvest,\n    tokenDecimals,\n    poolCategory,\n    totalStaked,\n    startBlock,\n    endBlock,\n    isFinished,\n    userData,\n    stakingLimit\n  } = pool; // Pools using native BNB behave differently than pools using a token\n\n  const isBnbPool = poolCategory === PoolCategory.BINANCE;\n  const TranslateString = useI18n();\n  const stakingTokenContract = useERC20(stakingTokenAddress);\n  const {\n    account\n  } = useWeb3React();\n  const {\n    onApprove\n  } = useSousApprove(stakingTokenContract, sousId);\n  const {\n    onStake\n  } = useSousStake(sousId, isBnbPool);\n  const {\n    onUnstake\n  } = useSousUnstake(sousId);\n  const {\n    onReward\n  } = useSousHarvest(sousId, isBnbPool); // APY\n\n  const rewardTokenPrice = useGetApiPrice(tokenName);\n  const stakingTokenPrice = useGetApiPrice(stakingTokenName);\n  const apy = getPoolApy(stakingTokenPrice, rewardTokenPrice, getBalanceNumber(pool.totalStaked, stakingTokenDecimals), parseFloat(pool.tokenPerBlock));\n  const [requestedApproval, setRequestedApproval] = useState(false);\n  const [pendingTx, setPendingTx] = useState(false);\n  const allowance = new BigNumber((userData === null || userData === void 0 ? void 0 : userData.allowance) || 0);\n  const stakingTokenBalance = new BigNumber((userData === null || userData === void 0 ? void 0 : userData.stakingTokenBalance) || 0);\n  const stakedBalance = new BigNumber((userData === null || userData === void 0 ? void 0 : userData.stakedBalance) || 0);\n  const earnings = new BigNumber((userData === null || userData === void 0 ? void 0 : userData.pendingReward) || 0);\n  const isOldSyrup = stakingTokenName === QuoteToken.SYRUP;\n  const accountHasStakedBalance = (stakedBalance === null || stakedBalance === void 0 ? void 0 : stakedBalance.toNumber()) > 0;\n  const needsApproval = !accountHasStakedBalance && !allowance.toNumber() && !isBnbPool;\n  const isCardActive = isFinished && accountHasStakedBalance;\n  const convertedLimit = new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals));\n  const [onPresentDeposit] = useModal( /*#__PURE__*/_jsxDEV(DepositModal, {\n    max: stakingLimit && stakingTokenBalance.isGreaterThan(convertedLimit) ? convertedLimit : stakingTokenBalance,\n    onConfirm: onStake,\n    tokenName: stakingLimit ? `${stakingTokenName} (${stakingLimit} max)` : stakingTokenName,\n    stakingTokenDecimals: stakingTokenDecimals\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this));\n  const [onPresentCompound] = useModal( /*#__PURE__*/_jsxDEV(CompoundModal, {\n    earnings: earnings,\n    onConfirm: onStake,\n    tokenName: stakingTokenName\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this));\n  const poolImage = `${pool.tokenName}-${pool.stakingTokenName}.png`.toLocaleLowerCase();\n  const [onPresentWithdraw] = useModal( /*#__PURE__*/_jsxDEV(WithdrawModal, {\n    max: stakedBalance,\n    onConfirm: onUnstake,\n    tokenName: stakingTokenName,\n    stakingTokenDecimals: stakingTokenDecimals\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this));\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true);\n      const txHash = await onApprove(); // user rejected tx or didn't go thru\n\n      if (!txHash) {\n        setRequestedApproval(false);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }, [onApprove, setRequestedApproval]);\n  return /*#__PURE__*/_jsxDEV(Card, {\n    isActive: isCardActive,\n    isFinished: isFinished && sousId !== 0,\n    children: [isFinished && sousId !== 0 && /*#__PURE__*/_jsxDEV(PoolFinishedSash, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 38\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '24px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(CardTitle, {\n        isFinished: isFinished && sousId !== 0,\n        children: [isOldSyrup && '[OLD]', \" \", tokenName, \" \", TranslateString(348, 'Pool')]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '8px',\n          display: 'flex',\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            flex: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(Image, {\n            src: `/images/pools/${poolImage}`,\n            alt: tokenName,\n            width: 64,\n            height: 64\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this), account && harvest && !isOldSyrup && /*#__PURE__*/_jsxDEV(HarvestButton, {\n          disabled: !earnings.toNumber() || pendingTx,\n          text: pendingTx ? 'Collecting' : 'Harvest',\n          onClick: async () => {\n            setPendingTx(true);\n            await onReward();\n            setPendingTx(false);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), !isOldSyrup ? /*#__PURE__*/_jsxDEV(BalanceAndCompound, {\n        children: [/*#__PURE__*/_jsxDEV(Balance, {\n          value: getBalanceNumber(earnings, tokenDecimals),\n          isDisabled: isFinished\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 13\n        }, this), sousId === 0 && account && harvest && /*#__PURE__*/_jsxDEV(HarvestButton, {\n          disabled: !earnings.toNumber() || pendingTx,\n          text: pendingTx ? TranslateString(999, 'Compounding') : TranslateString(704, 'Compound'),\n          onClick: onPresentCompound\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(OldSyrupTitle, {\n        hasBalance: accountHasStakedBalance\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Label, {\n        isFinished: isFinished && sousId !== 0,\n        text: TranslateString(330, `${tokenName} earned`)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(StyledCardActions, {\n        children: [!account && /*#__PURE__*/_jsxDEV(UnlockButton, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 24\n        }, this), account && (needsApproval && !isOldSyrup ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            flex: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            disabled: isFinished || requestedApproval,\n            onClick: handleApprove,\n            width: \"100%\",\n            children: `Approve ${stakingTokenName}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            disabled: stakedBalance.eq(new BigNumber(0)) || pendingTx,\n            onClick: isOldSyrup ? async () => {\n              setPendingTx(true);\n              await onUnstake('0', stakingTokenDecimals);\n              setPendingTx(false);\n            } : onPresentWithdraw,\n            children: `Unstake ${stakingTokenName}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(StyledActionSpacer, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 17\n          }, this), !isOldSyrup && /*#__PURE__*/_jsxDEV(IconButton, {\n            disabled: isFinished && sousId !== 0,\n            onClick: onPresentDeposit,\n            children: /*#__PURE__*/_jsxDEV(AddIcon, {\n              color: \"white\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(StyledDetails, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [TranslateString(384, 'Your Stake'), \":\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Balance, {\n          fontSize: \"14px\",\n          isDisabled: isFinished,\n          value: getBalanceNumber(stakedBalance, stakingTokenDecimals)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CardFooter, {\n      projectLink: projectLink,\n      decimals: stakingTokenDecimals,\n      totalStaked: totalStaked,\n      startBlock: startBlock,\n      endBlock: endBlock,\n      isFinished: isFinished,\n      poolCategory: poolCategory,\n      tokenName: tokenName,\n      tokenAddress: tokenAddress,\n      tokenDecimals: tokenDecimals\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n};\n\n_s(PoolCard, \"t6WHj1rrHO6LHp2QNcxA+QevLc0=\", false, function () {\n  return [useI18n, useERC20, useWeb3React, useSousApprove, useSousStake, useSousUnstake, useSousHarvest, useGetApiPrice, useGetApiPrice, useModal, useModal, useModal];\n});\n\n_c = PoolCard;\nconst PoolFinishedSash = styled.div`\n  background-image: url('/images/pool-finished-sash.svg');\n  background-position: top right;\n  background-repeat: not-repeat;\n  height: 135px;\n  position: absolute;\n  right: -24px;\n  top: -24px;\n  width: 135px;\n`;\n_c2 = PoolFinishedSash;\nconst StyledCardActions = styled.div`\n  display: flex;\n  justify-content: center;\n  margin: 16px 0;\n  width: 100%;\n  box-sizing: border-box;\n`;\n_c3 = StyledCardActions;\nconst BalanceAndCompound = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-direction: row;\n`;\n_c4 = BalanceAndCompound;\nconst StyledActionSpacer = styled.div`\n  height: ${props => props.theme.spacing[4]}px;\n  width: ${props => props.theme.spacing[4]}px;\n`;\n_c5 = StyledActionSpacer;\nconst StyledDetails = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 14px;\n`;\n_c6 = StyledDetails;\nexport default PoolCard;\n\nvar _c, _c2, _c3, _c4, _c5, _c6;\n\n$RefreshReg$(_c, \"PoolCard\");\n$RefreshReg$(_c2, \"PoolFinishedSash\");\n$RefreshReg$(_c3, \"StyledCardActions\");\n$RefreshReg$(_c4, \"BalanceAndCompound\");\n$RefreshReg$(_c5, \"StyledActionSpacer\");\n$RefreshReg$(_c6, \"StyledDetails\");","map":{"version":3,"sources":["/Users/rp/Desktop/death/answers/src/views/Pools/components/PoolCard.tsx"],"names":["BigNumber","React","useCallback","useState","styled","Button","IconButton","useModal","AddIcon","Image","useWeb3React","UnlockButton","Label","useERC20","useSousApprove","useI18n","useSousStake","useSousUnstake","getBalanceNumber","getPoolApy","useSousHarvest","Balance","QuoteToken","PoolCategory","useGetApiPrice","DepositModal","WithdrawModal","CompoundModal","CardTitle","Card","OldSyrupTitle","HarvestButton","CardFooter","PoolCard","pool","sousId","tokenName","tokenAddress","stakingTokenName","stakingTokenAddress","stakingTokenDecimals","projectLink","harvest","tokenDecimals","poolCategory","totalStaked","startBlock","endBlock","isFinished","userData","stakingLimit","isBnbPool","BINANCE","TranslateString","stakingTokenContract","account","onApprove","onStake","onUnstake","onReward","rewardTokenPrice","stakingTokenPrice","apy","parseFloat","tokenPerBlock","requestedApproval","setRequestedApproval","pendingTx","setPendingTx","allowance","stakingTokenBalance","stakedBalance","earnings","pendingReward","isOldSyrup","SYRUP","accountHasStakedBalance","toNumber","needsApproval","isCardActive","convertedLimit","multipliedBy","pow","onPresentDeposit","isGreaterThan","onPresentCompound","poolImage","toLocaleLowerCase","onPresentWithdraw","handleApprove","txHash","e","console","error","padding","marginBottom","display","alignItems","flex","eq","PoolFinishedSash","div","StyledCardActions","BalanceAndCompound","StyledActionSpacer","props","theme","spacing","StyledDetails"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport React, { useCallback, useState } from 'react'\nimport styled from 'styled-components'\nimport { Button, IconButton, useModal, AddIcon, Image } from '@pancakeswap-libs/uikit'\nimport { useWeb3React } from '@web3-react/core'\nimport UnlockButton from 'components/UnlockButton'\nimport Label from 'components/Label'\nimport { useERC20 } from 'hooks/useContract'\nimport { useSousApprove } from 'hooks/useApprove'\nimport useI18n from 'hooks/useI18n'\nimport { useSousStake } from 'hooks/useStake'\nimport { useSousUnstake } from 'hooks/useUnstake'\nimport { getBalanceNumber } from 'utils/formatBalance'\nimport { getPoolApy } from 'utils/apy'\nimport { useSousHarvest } from 'hooks/useHarvest'\nimport Balance from 'components/Balance'\nimport { QuoteToken, PoolCategory } from 'config/constants/types'\nimport { Pool } from 'state/types'\nimport { useGetApiPrice } from 'state/hooks'\nimport DepositModal from './DepositModal'\nimport WithdrawModal from './WithdrawModal'\nimport CompoundModal from './CompoundModal'\nimport CardTitle from './CardTitle'\nimport Card from './Card'\nimport OldSyrupTitle from './OldSyrupTitle'\nimport HarvestButton from './HarvestButton'\nimport CardFooter from './CardFooter'\n\ninterface HarvestProps {\n  pool: Pool\n}\n\nconst PoolCard: React.FC<HarvestProps> = ({ pool }) => {\n  const {\n    sousId,\n    tokenName,\n    tokenAddress,\n    stakingTokenName,\n    stakingTokenAddress,\n    stakingTokenDecimals,\n    projectLink,\n    harvest,\n    tokenDecimals,\n    poolCategory,\n    totalStaked,\n    startBlock,\n    endBlock,\n    isFinished,\n    userData,\n    stakingLimit,\n  } = pool\n  // Pools using native BNB behave differently than pools using a token\n  const isBnbPool = poolCategory === PoolCategory.BINANCE\n  const TranslateString = useI18n()\n  const stakingTokenContract = useERC20(stakingTokenAddress)\n  const { account } = useWeb3React()\n  const { onApprove } = useSousApprove(stakingTokenContract, sousId)\n  const { onStake } = useSousStake(sousId, isBnbPool)\n  const { onUnstake } = useSousUnstake(sousId)\n  const { onReward } = useSousHarvest(sousId, isBnbPool)\n\n  // APY\n  const rewardTokenPrice = useGetApiPrice(tokenName)\n  const stakingTokenPrice = useGetApiPrice(stakingTokenName)\n  const apy = getPoolApy(\n    stakingTokenPrice,\n    rewardTokenPrice,\n    getBalanceNumber(pool.totalStaked, stakingTokenDecimals),\n    parseFloat(pool.tokenPerBlock),\n  )\n\n  const [requestedApproval, setRequestedApproval] = useState(false)\n  const [pendingTx, setPendingTx] = useState(false)\n\n  const allowance = new BigNumber(userData?.allowance || 0)\n  const stakingTokenBalance = new BigNumber(userData?.stakingTokenBalance || 0)\n  const stakedBalance = new BigNumber(userData?.stakedBalance || 0)\n  const earnings = new BigNumber(userData?.pendingReward || 0)\n\n  const isOldSyrup = stakingTokenName === QuoteToken.SYRUP\n  const accountHasStakedBalance = stakedBalance?.toNumber() > 0\n  const needsApproval = !accountHasStakedBalance && !allowance.toNumber() && !isBnbPool\n  const isCardActive = isFinished && accountHasStakedBalance\n\n  const convertedLimit = new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(tokenDecimals))\n  const [onPresentDeposit] = useModal(\n    <DepositModal\n      max={stakingLimit && stakingTokenBalance.isGreaterThan(convertedLimit) ? convertedLimit : stakingTokenBalance}\n      onConfirm={onStake}\n      tokenName={stakingLimit ? `${stakingTokenName} (${stakingLimit} max)` : stakingTokenName}\n      stakingTokenDecimals={stakingTokenDecimals}\n    />,\n  )\n\n  const [onPresentCompound] = useModal(\n    <CompoundModal earnings={earnings} onConfirm={onStake} tokenName={stakingTokenName} />,\n  )\n  const poolImage = `${pool.tokenName}-${pool.stakingTokenName}.png`.toLocaleLowerCase()\n  const [onPresentWithdraw] = useModal(\n    <WithdrawModal\n      max={stakedBalance}\n      onConfirm={onUnstake}\n      tokenName={stakingTokenName}\n      stakingTokenDecimals={stakingTokenDecimals}\n    />,\n  )\n\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true)\n      const txHash = await onApprove()\n      // user rejected tx or didn't go thru\n      if (!txHash) {\n        setRequestedApproval(false)\n      }\n    } catch (e) {\n      console.error(e)\n    }\n  }, [onApprove, setRequestedApproval])\n\n  return (\n    <Card isActive={isCardActive} isFinished={isFinished && sousId !== 0}>\n      {isFinished && sousId !== 0 && <PoolFinishedSash />}\n      <div style={{ padding: '24px' }}>\n        <CardTitle isFinished={isFinished && sousId !== 0}>\n          {isOldSyrup && '[OLD]'} {tokenName} {TranslateString(348, 'Pool')}\n        </CardTitle>\n        <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\n          <div style={{ flex: 1 }}>\n            <Image src={`/images/pools/${poolImage}`} alt={tokenName} width={64} height={64} />\n          </div>\n          {account && harvest && !isOldSyrup && (\n            <HarvestButton\n              disabled={!earnings.toNumber() || pendingTx}\n              text={pendingTx ? 'Collecting' : 'Harvest'}\n              onClick={async () => {\n                setPendingTx(true)\n                await onReward()\n                setPendingTx(false)\n              }}\n            />\n          )}\n        </div>\n        {!isOldSyrup ? (\n          <BalanceAndCompound>\n            <Balance value={getBalanceNumber(earnings, tokenDecimals)} isDisabled={isFinished} />\n            {sousId === 0 && account && harvest && (\n              <HarvestButton\n                disabled={!earnings.toNumber() || pendingTx}\n                text={pendingTx ? TranslateString(999, 'Compounding') : TranslateString(704, 'Compound')}\n                onClick={onPresentCompound}\n              />\n            )}\n          </BalanceAndCompound>\n        ) : (\n          <OldSyrupTitle hasBalance={accountHasStakedBalance} />\n        )}\n        <Label isFinished={isFinished && sousId !== 0} text={TranslateString(330, `${tokenName} earned`)} />\n        <StyledCardActions>\n          {!account && <UnlockButton />}\n          {account &&\n            (needsApproval && !isOldSyrup ? (\n              <div style={{ flex: 1 }}>\n                <Button disabled={isFinished || requestedApproval} onClick={handleApprove} width=\"100%\">\n                  {`Approve ${stakingTokenName}`}\n                </Button>\n              </div>\n            ) : (\n              <>\n                <Button\n                  disabled={stakedBalance.eq(new BigNumber(0)) || pendingTx}\n                  onClick={\n                    isOldSyrup\n                      ? async () => {\n                          setPendingTx(true)\n                          await onUnstake('0', stakingTokenDecimals)\n                          setPendingTx(false)\n                        }\n                      : onPresentWithdraw\n                  }\n                >\n                  {`Unstake ${stakingTokenName}`}\n                </Button>\n                <StyledActionSpacer />\n                {!isOldSyrup && (\n                  <IconButton disabled={isFinished && sousId !== 0} onClick={onPresentDeposit}>\n                    <AddIcon color=\"white\" />\n                  </IconButton>\n                )}\n              </>\n            ))}\n        </StyledCardActions>\n        {/* <StyledDetails>\n          <div>{TranslateString(736, 'APR')}:</div>\n          {isFinished || isOldSyrup || !apy ? (\n            '-'\n          ) : (\n            <Balance fontSize=\"14px\" isDisabled={isFinished} value={apy} decimals={2} unit=\"%\" />\n          )}\n        </StyledDetails> */}\n        <StyledDetails>\n          <div>{TranslateString(384, 'Your Stake')}:</div>\n          <Balance\n            fontSize=\"14px\"\n            isDisabled={isFinished}\n            value={getBalanceNumber(stakedBalance, stakingTokenDecimals)}\n          />\n        </StyledDetails>\n      </div>\n      <CardFooter\n        projectLink={projectLink}\n        decimals={stakingTokenDecimals}\n        totalStaked={totalStaked}\n        startBlock={startBlock}\n        endBlock={endBlock}\n        isFinished={isFinished}\n        poolCategory={poolCategory}\n        tokenName={tokenName}\n        tokenAddress={tokenAddress}\n        tokenDecimals={tokenDecimals}\n      />\n    </Card>\n  )\n}\n\nconst PoolFinishedSash = styled.div`\n  background-image: url('/images/pool-finished-sash.svg');\n  background-position: top right;\n  background-repeat: not-repeat;\n  height: 135px;\n  position: absolute;\n  right: -24px;\n  top: -24px;\n  width: 135px;\n`\n\nconst StyledCardActions = styled.div`\n  display: flex;\n  justify-content: center;\n  margin: 16px 0;\n  width: 100%;\n  box-sizing: border-box;\n`\n\nconst BalanceAndCompound = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-direction: row;\n`\n\nconst StyledActionSpacer = styled.div`\n  height: ${(props) => props.theme.spacing[4]}px;\n  width: ${(props) => props.theme.spacing[4]}px;\n`\n\nconst StyledDetails = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 14px;\n`\n\nexport default PoolCard\n"]},"metadata":{},"sourceType":"module"}