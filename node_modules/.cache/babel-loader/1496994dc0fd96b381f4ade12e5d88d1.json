{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rp/Desktop/death/quest/answers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/rp/Desktop/death/quest/answers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/rp/Desktop/death/quest/answers/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{getPointCenterIfoContract}from'utils/contractHelpers';import ifosList from'config/constants/ifo';import{campaignMap}from'config/constants/campaigns';import makeBatchRequest from'./makeBatchRequest';export var getAchievementTitle=function getAchievementTitle(campaign){switch(campaign.type){case'ifo':return{id:999,fallback:\"IFO Shopper: \".concat(campaign.title),data:{name:campaign.title}};default:return campaign.title;}};export var getAchievementDescription=function getAchievementDescription(campaign){switch(campaign.type){case'ifo':return{id:999,fallback:\"Committed more than $5 worth of LP in the \".concat(campaign.title,\" IFO\"),data:{name:campaign.title}};default:return campaign.description;}};/**\n * Checks if a wallet is eligble to claim points from valid IFO's\n */export var getClaimableIfoData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(account){var ifoCampaigns,ifoCampaignAddresses,pointCenterContract,claimStatuses,claimableIfoData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ifoCampaigns=ifosList.filter(function(ifoItem){return ifoItem.campaignId!==undefined;});ifoCampaignAddresses=ifoCampaigns.map(function(ifoItem){return ifoItem.address;});pointCenterContract=getPointCenterIfoContract();// Returns the claim status of every IFO with a campaign ID\n_context.next=5;return pointCenterContract.methods.checkClaimStatuses(account,ifoCampaignAddresses).call();case 5:claimStatuses=_context.sent;_context.next=8;return makeBatchRequest(claimStatuses.reduce(function(accum,claimStatus,index){if(claimStatus===true){return[].concat(_toConsumableArray(accum),[pointCenterContract.methods.ifos(ifoCampaignAddresses[index]).call]);}return accum;},[]));case 8:claimableIfoData=_context.sent;return _context.abrupt(\"return\",claimableIfoData.reduce(function(accum,claimableIfoDataItem){if(!campaignMap.has(claimableIfoDataItem.campaignId)){return accum;}var campaignMeta=campaignMap.get(claimableIfoDataItem.campaignId);var _ifoCampaigns$find=ifoCampaigns.find(function(ifoCampaign){return ifoCampaign.campaignId===claimableIfoDataItem.campaignId;}),address=_ifoCampaigns$find.address;return[].concat(_toConsumableArray(accum),[{address:address,id:claimableIfoDataItem.campaignId,type:'ifo',title:getAchievementTitle(campaignMeta),description:getAchievementDescription(campaignMeta),badge:campaignMeta.badge,points:Number(claimableIfoDataItem.numberPoints)}]);},[]));case 10:case\"end\":return _context.stop();}}},_callee);}));return function getClaimableIfoData(_x){return _ref.apply(this,arguments);};}();","map":{"version":3,"sources":["/Users/rp/Desktop/death/quest/answers/src/utils/achievements.ts"],"names":["getPointCenterIfoContract","ifosList","campaignMap","makeBatchRequest","getAchievementTitle","campaign","type","id","fallback","title","data","name","getAchievementDescription","description","getClaimableIfoData","account","ifoCampaigns","filter","ifoItem","campaignId","undefined","ifoCampaignAddresses","map","address","pointCenterContract","methods","checkClaimStatuses","call","claimStatuses","reduce","accum","claimStatus","index","ifos","claimableIfoData","claimableIfoDataItem","has","campaignMeta","get","find","ifoCampaign","badge","points","Number","numberPoints"],"mappings":"ydACA,OAASA,yBAAT,KAA0C,uBAA1C,CACA,MAAOC,CAAAA,QAAP,KAAqB,sBAArB,CACA,OAASC,WAAT,KAA4B,4BAA5B,CAEA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CAQA,MAAO,IAAMC,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACC,QAAD,CAA0C,CAC3E,OAAQA,QAAQ,CAACC,IAAjB,EACE,IAAK,KAAL,CACE,MAAO,CACLC,EAAE,CAAE,GADC,CAELC,QAAQ,wBAAkBH,QAAQ,CAACI,KAA3B,CAFH,CAGLC,IAAI,CAAE,CACJC,IAAI,CAAEN,QAAQ,CAACI,KADX,CAHD,CAAP,CAOF,QACE,MAAOJ,CAAAA,QAAQ,CAACI,KAAhB,CAVJ,CAYD,CAbM,CAeP,MAAO,IAAMG,CAAAA,yBAAyB,CAAG,QAA5BA,CAAAA,yBAA4B,CAACP,QAAD,CAA0C,CACjF,OAAQA,QAAQ,CAACC,IAAjB,EACE,IAAK,KAAL,CACE,MAAO,CACLC,EAAE,CAAE,GADC,CAELC,QAAQ,qDAA+CH,QAAQ,CAACI,KAAxD,QAFH,CAGLC,IAAI,CAAE,CACJC,IAAI,CAAEN,QAAQ,CAACI,KADX,CAHD,CAAP,CAOF,QACE,MAAOJ,CAAAA,QAAQ,CAACQ,WAAhB,CAVJ,CAYD,CAbM,CAeP;AACA;AACA,GACA,MAAO,IAAMC,CAAAA,mBAAmB,0FAAG,iBAAOC,OAAP,2MAC3BC,YAD2B,CACZf,QAAQ,CAACgB,MAAT,CAAgB,SAACC,OAAD,QAAaA,CAAAA,OAAO,CAACC,UAAR,GAAuBC,SAApC,EAAhB,CADY,CAE3BC,oBAF2B,CAEJL,YAAY,CAACM,GAAb,CAAiB,SAACJ,OAAD,QAAaA,CAAAA,OAAO,CAACK,OAArB,EAAjB,CAFI,CAG3BC,mBAH2B,CAGLxB,yBAAyB,EAHpB,CAKjC;AALiC,sBAMJwB,CAAAA,mBAAmB,CAACC,OAApB,CAC1BC,kBAD0B,CACPX,OADO,CACEM,oBADF,EAE1BM,IAF0B,EANI,QAM3BC,aAN2B,qCAWDzB,CAAAA,gBAAgB,CAC9CyB,aAAa,CAACC,MAAd,CAAqB,SAACC,KAAD,CAAQC,WAAR,CAAqBC,KAArB,CAA+B,CAClD,GAAID,WAAW,GAAK,IAApB,CAA0B,CACxB,mCAAWD,KAAX,GAAkBN,mBAAmB,CAACC,OAApB,CAA4BQ,IAA5B,CAAiCZ,oBAAoB,CAACW,KAAD,CAArD,EAA8DL,IAAhF,GACD,CAED,MAAOG,CAAAA,KAAP,CACD,CAND,CAMG,EANH,CAD8C,CAXf,QAW3BI,gBAX2B,+CAsB1BA,gBAAgB,CAACL,MAAjB,CAAwB,SAACC,KAAD,CAAQK,oBAAR,CAAiC,CAC9D,GAAI,CAACjC,WAAW,CAACkC,GAAZ,CAAgBD,oBAAoB,CAAChB,UAArC,CAAL,CAAuD,CACrD,MAAOW,CAAAA,KAAP,CACD,CAED,GAAMO,CAAAA,YAAY,CAAGnC,WAAW,CAACoC,GAAZ,CAAgBH,oBAAoB,CAAChB,UAArC,CAArB,CAL8D,uBAM1CH,YAAY,CAACuB,IAAb,CAAkB,SAACC,WAAD,QAAiBA,CAAAA,WAAW,CAACrB,UAAZ,GAA2BgB,oBAAoB,CAAChB,UAAjE,EAAlB,CAN0C,CAMtDI,OANsD,oBAMtDA,OANsD,CAQ9D,mCACKO,KADL,GAEE,CACEP,OAAO,CAAPA,OADF,CAEEhB,EAAE,CAAE4B,oBAAoB,CAAChB,UAF3B,CAGEb,IAAI,CAAE,KAHR,CAIEG,KAAK,CAAEL,mBAAmB,CAACiC,YAAD,CAJ5B,CAKExB,WAAW,CAAED,yBAAyB,CAACyB,YAAD,CALxC,CAMEI,KAAK,CAAEJ,YAAY,CAACI,KANtB,CAOEC,MAAM,CAAEC,MAAM,CAACR,oBAAoB,CAACS,YAAtB,CAPhB,CAFF,GAYD,CApBM,CAoBJ,EApBI,CAtB0B,yDAAH,kBAAnB9B,CAAAA,mBAAmB,4CAAzB","sourcesContent":["import { Campaign } from 'config/constants/types'\nimport { getPointCenterIfoContract } from 'utils/contractHelpers'\nimport ifosList from 'config/constants/ifo'\nimport { campaignMap } from 'config/constants/campaigns'\nimport { Achievement, TranslatableText } from 'state/types'\nimport makeBatchRequest from './makeBatchRequest'\n\ninterface IfoMapResponse {\n  thresholdToClaim: string\n  campaignId: string\n  numberPoints: string\n}\n\nexport const getAchievementTitle = (campaign: Campaign): TranslatableText => {\n  switch (campaign.type) {\n    case 'ifo':\n      return {\n        id: 999,\n        fallback: `IFO Shopper: ${campaign.title}`,\n        data: {\n          name: campaign.title as string,\n        },\n      }\n    default:\n      return campaign.title\n  }\n}\n\nexport const getAchievementDescription = (campaign: Campaign): TranslatableText => {\n  switch (campaign.type) {\n    case 'ifo':\n      return {\n        id: 999,\n        fallback: `Committed more than $5 worth of LP in the ${campaign.title} IFO`,\n        data: {\n          name: campaign.title as string,\n        },\n      }\n    default:\n      return campaign.description\n  }\n}\n\n/**\n * Checks if a wallet is eligble to claim points from valid IFO's\n */\nexport const getClaimableIfoData = async (account: string): Promise<Achievement[]> => {\n  const ifoCampaigns = ifosList.filter((ifoItem) => ifoItem.campaignId !== undefined)\n  const ifoCampaignAddresses = ifoCampaigns.map((ifoItem) => ifoItem.address)\n  const pointCenterContract = getPointCenterIfoContract()\n\n  // Returns the claim status of every IFO with a campaign ID\n  const claimStatuses = (await pointCenterContract.methods\n    .checkClaimStatuses(account, ifoCampaignAddresses)\n    .call()) as boolean[]\n\n  // Get IFO data for all IFO's that are eligible to claim\n  const claimableIfoData = (await makeBatchRequest(\n    claimStatuses.reduce((accum, claimStatus, index) => {\n      if (claimStatus === true) {\n        return [...accum, pointCenterContract.methods.ifos(ifoCampaignAddresses[index]).call]\n      }\n\n      return accum\n    }, []),\n  )) as IfoMapResponse[]\n\n  // Transform response to an Achievement\n  return claimableIfoData.reduce((accum, claimableIfoDataItem) => {\n    if (!campaignMap.has(claimableIfoDataItem.campaignId)) {\n      return accum\n    }\n\n    const campaignMeta = campaignMap.get(claimableIfoDataItem.campaignId)\n    const { address } = ifoCampaigns.find((ifoCampaign) => ifoCampaign.campaignId === claimableIfoDataItem.campaignId)\n\n    return [\n      ...accum,\n      {\n        address,\n        id: claimableIfoDataItem.campaignId,\n        type: 'ifo',\n        title: getAchievementTitle(campaignMeta),\n        description: getAchievementDescription(campaignMeta),\n        badge: campaignMeta.badge,\n        points: Number(claimableIfoDataItem.numberPoints),\n      },\n    ]\n  }, [])\n}\n"]},"metadata":{},"sourceType":"module"}