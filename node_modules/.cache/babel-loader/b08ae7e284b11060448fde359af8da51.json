{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/rp/Desktop/death/LOU10_sourcecode/toModifyFarms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _regeneratorRuntime from\"/Users/rp/Desktop/death/LOU10_sourcecode/toModifyFarms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rp/Desktop/death/LOU10_sourcecode/toModifyFarms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/rp/Desktop/death/LOU10_sourcecode/toModifyFarms/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _templateObject,_templateObject2,_templateObject3;import React,{useCallback,useMemo,useState}from'react';import styled from'styled-components';import{Button,Modal}from'@pancakeswap-libs/uikit';import{getFullDisplayBalance}from'utils/formatBalance';import TicketInput from'components/TicketInput';import ModalActions from'components/ModalActions';import{useMultiBuyLottery,useMaxNumber}from'hooks/useBuyLottery';import useI18n from'hooks/useI18n';import{LOTTERY_MAX_NUMBER_OF_TICKETS,LOTTERY_TICKET_PRICE}from'config';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var BuyTicketModal=function BuyTicketModal(_ref){var max=_ref.max,onDismiss=_ref.onDismiss;var _useState=useState('1'),_useState2=_slicedToArray(_useState,2),val=_useState2[0],setVal=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),pendingTx=_useState4[0],setPendingTx=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),setRequestedBuy=_useState6[1];var TranslateString=useI18n();var fullBalance=useMemo(function(){return getFullDisplayBalance(max);},[max]);var maxTickets=useMemo(function(){return parseInt(getFullDisplayBalance(max.div(LOTTERY_TICKET_PRICE)),10);},[max]);var handleChange=function handleChange(e){return setVal(e.currentTarget.value);};var _useMultiBuyLottery=useMultiBuyLottery(),onMultiBuy=_useMultiBuyLottery.onMultiBuy;var maxNumber=useMaxNumber();var handleBuy=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var length,_numbers,txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setRequestedBuy(true);length=parseInt(val);// @ts-ignore\n// eslint-disable-next-line prefer-spread\n_numbers=Array.apply(null,{length:length}).map(function(){return[Math.floor(Math.random()*maxNumber)+1,Math.floor(Math.random()*maxNumber)+1,Math.floor(Math.random()*maxNumber)+1,Math.floor(Math.random()*maxNumber)+1];});_context.next=6;return onMultiBuy(LOTTERY_TICKET_PRICE.toString(),_numbers);case 6:txHash=_context.sent;// user rejected tx or didn't go thru\nif(txHash){setRequestedBuy(false);}_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);})),[onMultiBuy,setRequestedBuy,maxNumber,val]);var handleSelectMax=useCallback(function(){if(Number(maxTickets)>LOTTERY_MAX_NUMBER_OF_TICKETS){setVal(LOTTERY_MAX_NUMBER_OF_TICKETS.toString());}else{setVal(maxTickets.toString());}},[maxTickets]);var cakeCosts=function cakeCosts(amount){return+amount*LOTTERY_TICKET_PRICE;};return/*#__PURE__*/_jsxs(Modal,{title:TranslateString(450,'Enter amount of tickets to buy'),onDismiss:onDismiss,children:[/*#__PURE__*/_jsx(TicketInput,{value:val,onSelectMax:handleSelectMax,onChange:handleChange,max:fullBalance,symbol:\"TICKET\",availableSymbol:\"QUESTIONMARK\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Tips,{children:TranslateString(999,\"1 Ticket = \".concat(LOTTERY_TICKET_PRICE,\" QUESTIONMARK\"),{num:LOTTERY_TICKET_PRICE})})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Announce,{children:TranslateString(478,'Ticket purchases are final. Your QUESTIONMARK cannot be returned to you after buying tickets.')}),/*#__PURE__*/_jsx(Final,{children:TranslateString(460,\"You will spend: \".concat(cakeCosts(val),\" QUESTIONMARK\"))})]}),/*#__PURE__*/_jsxs(ModalActions,{children:[/*#__PURE__*/_jsx(Button,{width:\"100%\",variant:\"secondary\",onClick:onDismiss,children:TranslateString(462,'Cancel')}),/*#__PURE__*/_jsx(Button,{id:\"lottery-buy-complete\",width:\"100%\",disabled:pendingTx||parseInt(val)>Number(maxTickets)||parseInt(val)>LOTTERY_MAX_NUMBER_OF_TICKETS||parseInt(val)<1,onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setPendingTx(true);_context2.next=3;return handleBuy();case 3:setPendingTx(false);onDismiss();case 5:case\"end\":return _context2.stop();}}},_callee2);})),children:pendingTx?TranslateString(488,'Pending Confirmation'):TranslateString(464,'Confirm')})]})]});};export default BuyTicketModal;var Tips=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-left: 0.4em;\\n  font-size: 14px;\\n  font-weight: 600;\\n  color: \",\";\\n\"])),function(props){return props.theme.colors.primary;});var Final=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin-top: 1em;\\n  text-align: center;\\n  font-size: 20px;\\n  font-weight: 600;\\n  color: \",\";\\n\"])),function(props){return props.theme.colors.primary;});var Announce=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  margin-top: 1em;\\n  margin-left: 0.4em;\\n  color: #ed4b9e;\\n\"])));","map":{"version":3,"sources":["/Users/rp/Desktop/death/LOU10_sourcecode/toModifyFarms/src/views/Lottery/components/TicketCard/BuyTicketModal.tsx"],"names":["React","useCallback","useMemo","useState","styled","Button","Modal","getFullDisplayBalance","TicketInput","ModalActions","useMultiBuyLottery","useMaxNumber","useI18n","LOTTERY_MAX_NUMBER_OF_TICKETS","LOTTERY_TICKET_PRICE","BuyTicketModal","max","onDismiss","val","setVal","pendingTx","setPendingTx","setRequestedBuy","TranslateString","fullBalance","maxTickets","parseInt","div","handleChange","e","currentTarget","value","onMultiBuy","maxNumber","handleBuy","length","numbers","Array","apply","map","Math","floor","random","toString","txHash","console","error","handleSelectMax","Number","cakeCosts","amount","num","Tips","props","theme","colors","primary","Final","Announce"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport React, { useCallback, useMemo, useState } from 'react'\nimport styled from 'styled-components'\nimport { Button, Modal } from '@pancakeswap-libs/uikit'\nimport { getFullDisplayBalance } from 'utils/formatBalance'\nimport TicketInput from 'components/TicketInput'\nimport ModalActions from 'components/ModalActions'\nimport { useMultiBuyLottery, useMaxNumber } from 'hooks/useBuyLottery'\nimport useI18n from 'hooks/useI18n'\nimport { LOTTERY_MAX_NUMBER_OF_TICKETS, LOTTERY_TICKET_PRICE } from 'config'\n\ninterface BuyTicketModalProps {\n  max: BigNumber\n  onConfirm?: (amount: string, numbers: Array<number>) => void\n  onDismiss?: () => void\n  tokenName?: string\n}\n\nconst BuyTicketModal: React.FC<BuyTicketModalProps> = ({ max, onDismiss }) => {\n  const [val, setVal] = useState('1')\n  const [pendingTx, setPendingTx] = useState(false)\n  const [, setRequestedBuy] = useState(false)\n  const TranslateString = useI18n()\n  const fullBalance = useMemo(() => {\n    return getFullDisplayBalance(max)\n  }, [max])\n\n  const maxTickets = useMemo(() => {\n    return parseInt(getFullDisplayBalance(max.div(LOTTERY_TICKET_PRICE)), 10)\n  }, [max])\n\n  const handleChange = (e: React.FormEvent<HTMLInputElement>) => setVal(e.currentTarget.value)\n\n  const { onMultiBuy } = useMultiBuyLottery()\n  const maxNumber = useMaxNumber()\n  const handleBuy = useCallback(async () => {\n    try {\n      setRequestedBuy(true)\n      const length = parseInt(val)\n      // @ts-ignore\n      // eslint-disable-next-line prefer-spread\n      const numbers = Array.apply(null, { length }).map(() => [\n        Math.floor(Math.random() * maxNumber) + 1,\n        Math.floor(Math.random() * maxNumber) + 1,\n        Math.floor(Math.random() * maxNumber) + 1,\n        Math.floor(Math.random() * maxNumber) + 1,\n      ])\n      const txHash = await onMultiBuy(LOTTERY_TICKET_PRICE.toString(), numbers)\n      // user rejected tx or didn't go thru\n      if (txHash) {\n        setRequestedBuy(false)\n      }\n    } catch (e) {\n      console.error(e)\n    }\n  }, [onMultiBuy, setRequestedBuy, maxNumber, val])\n\n  const handleSelectMax = useCallback(() => {\n    if (Number(maxTickets) > LOTTERY_MAX_NUMBER_OF_TICKETS) {\n      setVal(LOTTERY_MAX_NUMBER_OF_TICKETS.toString())\n    } else {\n      setVal(maxTickets.toString())\n    }\n  }, [maxTickets])\n\n  const cakeCosts = (amount: string): number => {\n    return +amount * LOTTERY_TICKET_PRICE\n  }\n  return (\n    <Modal title={TranslateString(450, 'Enter amount of tickets to buy')} onDismiss={onDismiss}>\n      <TicketInput\n        value={val}\n        onSelectMax={handleSelectMax}\n        onChange={handleChange}\n        max={fullBalance}\n        symbol=\"TICKET\"\n        availableSymbol=\"QUESTIONMARK\"\n      />\n      <div>\n        <Tips>{TranslateString(999, `1 Ticket = ${LOTTERY_TICKET_PRICE} QUESTIONMARK`, { num: LOTTERY_TICKET_PRICE })}</Tips>\n      </div>\n      <div>\n        <Announce>\n          {TranslateString(\n            478,\n            'Ticket purchases are final. Your QUESTIONMARK cannot be returned to you after buying tickets.',\n          )}\n        </Announce>\n        <Final>{TranslateString(460, `You will spend: ${cakeCosts(val)} QUESTIONMARK`)}</Final>\n      </div>\n      <ModalActions>\n        <Button width=\"100%\" variant=\"secondary\" onClick={onDismiss}>\n          {TranslateString(462, 'Cancel')}\n        </Button>\n        <Button\n          id=\"lottery-buy-complete\"\n          width=\"100%\"\n          disabled={\n            pendingTx ||\n            parseInt(val) > Number(maxTickets) ||\n            parseInt(val) > LOTTERY_MAX_NUMBER_OF_TICKETS ||\n            parseInt(val) < 1\n          }\n          onClick={async () => {\n            setPendingTx(true)\n            await handleBuy()\n            setPendingTx(false)\n            onDismiss()\n          }}\n        >\n          {pendingTx ? TranslateString(488, 'Pending Confirmation') : TranslateString(464, 'Confirm')}\n        </Button>\n      </ModalActions>\n    </Modal>\n  )\n}\n\nexport default BuyTicketModal\n\nconst Tips = styled.div`\n  margin-left: 0.4em;\n  font-size: 14px;\n  font-weight: 600;\n  color: ${(props) => props.theme.colors.primary};\n`\n\nconst Final = styled.div`\n  margin-top: 1em;\n  text-align: center;\n  font-size: 20px;\n  font-weight: 600;\n  color: ${(props) => props.theme.colors.primary};\n`\nconst Announce = styled.div`\n  margin-top: 1em;\n  margin-left: 0.4em;\n  color: #ed4b9e;\n`\n"]},"metadata":{},"sourceType":"module"}