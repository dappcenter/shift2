{"ast":null,"code":"import _toConsumableArray from\"/Users/rp/Desktop/shift2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/rp/Desktop/shift2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _taggedTemplateLiteral from\"/Users/rp/Desktop/shift2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _asyncToGenerator from\"/Users/rp/Desktop/shift2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";var _templateObject;import{request,gql}from'graphql-request';import{campaignMap}from'config/constants/campaigns';import{getAchievementTitle,getAchievementDescription}from'utils/achievements';var profileSubgraphApi=process.env.REACT_APP_SUBGRAPH_PROFILE;/**\n * Gets all user point increase events on the profile filtered by wallet address\n */export var getUserPointIncreaseEvents=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(account){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return request(profileSubgraphApi,gql(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n        {\\n          user(id: \\\"\",\"\\\") {\\n            points {\\n              id\\n              campaignId\\n              points\\n            }\\n          }\\n        }\\n      \"])),account.toLowerCase()));case 3:data=_context.sent;return _context.abrupt(\"return\",data.user.points);case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",null);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function getUserPointIncreaseEvents(_x){return _ref.apply(this,arguments);};}();/**\n * Gets all user point increase events and adds achievement meta\n */export var getAchievements=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(account){var pointIncreaseEvents;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getUserPointIncreaseEvents(account);case 2:pointIncreaseEvents=_context2.sent;if(pointIncreaseEvents){_context2.next=5;break;}return _context2.abrupt(\"return\",[]);case 5:return _context2.abrupt(\"return\",pointIncreaseEvents.reduce(function(accum,userPoint){var campaignMeta=campaignMap.get(userPoint.campaignId);return[].concat(_toConsumableArray(accum),[{id:userPoint.campaignId,type:campaignMeta.type,address:userPoint.id,title:getAchievementTitle(campaignMeta),description:getAchievementDescription(campaignMeta),badge:campaignMeta.badge,points:Number(userPoint.points)}]);},[]));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function getAchievements(_x2){return _ref2.apply(this,arguments);};}();","map":{"version":3,"sources":["/Users/rp/Desktop/shift2/src/state/achievements/helpers.ts"],"names":["request","gql","campaignMap","getAchievementTitle","getAchievementDescription","profileSubgraphApi","process","env","REACT_APP_SUBGRAPH_PROFILE","getUserPointIncreaseEvents","account","toLowerCase","data","user","points","getAchievements","pointIncreaseEvents","reduce","accum","userPoint","campaignMeta","get","campaignId","id","type","address","title","description","badge","Number"],"mappings":"qmBAAA,OAASA,OAAT,CAAkBC,GAAlB,KAA6B,iBAA7B,CACA,OAASC,WAAT,KAA4B,4BAA5B,CAEA,OAASC,mBAAT,CAA8BC,yBAA9B,KAA+D,oBAA/D,CAQA,GAAMC,CAAAA,kBAAkB,CAAGC,OAAO,CAACC,GAAR,CAAYC,0BAAvC,CAEA;AACA;AACA,GACA,MAAO,IAAMC,CAAAA,0BAA0B,0FAAG,iBAAOC,OAAP,iKAEnBV,CAAAA,OAAO,CACxBK,kBADwB,CAExBJ,GAFwB,kPAIRS,OAAO,CAACC,WAAR,EAJQ,EAFY,QAEhCC,IAFgC,+CAgB/BA,IAAI,CAACC,IAAL,CAAUC,MAhBqB,0FAkB/B,IAlB+B,sEAAH,kBAA1BL,CAAAA,0BAA0B,4CAAhC,CAsBP;AACA;AACA,GACA,MAAO,IAAMM,CAAAA,eAAe,2FAAG,kBAAOL,OAAP,qKACKD,CAAAA,0BAA0B,CAACC,OAAD,CAD/B,QACvBM,mBADuB,mBAGxBA,mBAHwB,2DAIpB,EAJoB,0CAOtBA,mBAAmB,CAACC,MAApB,CAA2B,SAACC,KAAD,CAAQC,SAAR,CAAsB,CACtD,GAAMC,CAAAA,YAAY,CAAGlB,WAAW,CAACmB,GAAZ,CAAgBF,SAAS,CAACG,UAA1B,CAArB,CAEA,mCACKJ,KADL,GAEE,CACEK,EAAE,CAAEJ,SAAS,CAACG,UADhB,CAEEE,IAAI,CAAEJ,YAAY,CAACI,IAFrB,CAGEC,OAAO,CAAEN,SAAS,CAACI,EAHrB,CAIEG,KAAK,CAAEvB,mBAAmB,CAACiB,YAAD,CAJ5B,CAKEO,WAAW,CAAEvB,yBAAyB,CAACgB,YAAD,CALxC,CAMEQ,KAAK,CAAER,YAAY,CAACQ,KANtB,CAOEd,MAAM,CAAEe,MAAM,CAACV,SAAS,CAACL,MAAX,CAPhB,CAFF,GAYD,CAfM,CAeJ,EAfI,CAPsB,0DAAH,kBAAfC,CAAAA,eAAe,8CAArB","sourcesContent":["import { request, gql } from 'graphql-request'\nimport { campaignMap } from 'config/constants/campaigns'\nimport { Achievement } from 'state/types'\nimport { getAchievementTitle, getAchievementDescription } from 'utils/achievements'\n\ninterface UserPointIncreaseEvent {\n  campaignId: string\n  id: string // wallet address\n  points: string\n}\n\nconst profileSubgraphApi = process.env.REACT_APP_SUBGRAPH_PROFILE\n\n/**\n * Gets all user point increase events on the profile filtered by wallet address\n */\nexport const getUserPointIncreaseEvents = async (account: string): Promise<UserPointIncreaseEvent[]> => {\n  try {\n    const data = await request(\n      profileSubgraphApi,\n      gql`\n        {\n          user(id: \"${account.toLowerCase()}\") {\n            points {\n              id\n              campaignId\n              points\n            }\n          }\n        }\n      `,\n    )\n    return data.user.points\n  } catch (error) {\n    return null\n  }\n}\n\n/**\n * Gets all user point increase events and adds achievement meta\n */\nexport const getAchievements = async (account: string): Promise<Achievement[]> => {\n  const pointIncreaseEvents = await getUserPointIncreaseEvents(account)\n\n  if (!pointIncreaseEvents) {\n    return []\n  }\n\n  return pointIncreaseEvents.reduce((accum, userPoint) => {\n    const campaignMeta = campaignMap.get(userPoint.campaignId)\n\n    return [\n      ...accum,\n      {\n        id: userPoint.campaignId,\n        type: campaignMeta.type,\n        address: userPoint.id,\n        title: getAchievementTitle(campaignMeta),\n        description: getAchievementDescription(campaignMeta),\n        badge: campaignMeta.badge,\n        points: Number(userPoint.points),\n      },\n    ]\n  }, [])\n}\n"]},"metadata":{},"sourceType":"module"}